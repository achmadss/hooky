FROM oven/bun:latest

WORKDIR /app

# Install dependencies (provides Linux-native binaries like SWC)
COPY package.json bun.lock ./
RUN bun install

# Copy prisma schema and generate client
COPY prisma ./prisma/
RUN bun prisma generate

EXPOSE 3000

COPY entrypoint.dev.sh /entrypoint.dev.sh
RUN chmod +x /entrypoint.dev.sh

# Hot reload via mounted source - run migrations then start dev server
ENTRYPOINT ["/entrypoint.dev.sh"]
